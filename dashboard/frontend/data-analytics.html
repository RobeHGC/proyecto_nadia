<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“Š Data Analytics - NADIA HITL</title>
    
    <!-- Core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/responsive/2.4.1/css/responsive.bootstrap5.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #1a1a1a;
            --card-bg: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
        }

        [data-theme="dark"] {
            --card-bg: #2d3748;
            --text-primary: #ffffff;
            --text-secondary: #cbd5e0;
            --border-color: #4a5568;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-primary);
        }

        .main-container {
            background: var(--card-bg);
            border-radius: 20px;
            margin: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .navbar-custom {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            border-radius: 20px 20px 0 0;
        }

        .nav-pills .nav-link {
            border-radius: 12px;
            margin: 0 5px;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .nav-pills .nav-link:hover:not(.active) {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
        }

        .metric-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            height: 100%;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            margin-bottom: 16px;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .chart-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .chart-container canvas {
            max-height: 300px !important;
            height: 300px !important;
            width: 100% !important;
        }

        #overview-chart {
            max-height: 300px !important;
            height: 300px !important;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .table-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .table {
            margin-bottom: 0;
        }

        .table th {
            border-top: none;
            font-weight: 600;
            color: var(--text-primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .btn-custom {
            border-radius: 10px;
            padding: 8px 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary-custom {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-primary-custom:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .filters-panel {
            background: rgba(99, 102, 241, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid rgba(99, 102, 241, 0.1);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-online {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .status-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .progress-custom {
            height: 8px;
            border-radius: 4px;
            background: rgba(99, 102, 241, 0.1);
        }

        .progress-bar-custom {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 4px;
        }

        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        .backup-item {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .backup-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        @media (max-width: 768px) {
            .main-container {
                margin: 10px;
                border-radius: 16px;
            }
            
            .metric-card {
                margin-bottom: 16px;
            }
            
            .chart-container {
                padding: 16px;
            }
        }

        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.6);
        }

        .auto-refresh-indicator {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .auto-refresh-indicator.show {
            opacity: 1;
        }

        .data-highlight {
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid var(--success-color);
            padding: 2px 8px;
            border-radius: 0 4px 4px 0;
            animation: highlight-fade 3s ease-out;
        }

        @keyframes highlight-fade {
            0% { background: rgba(16, 185, 129, 0.3); }
            100% { background: rgba(16, 185, 129, 0.1); }
        }

        /* Quick Filters Styles */
        .form-range {
            height: 8px;
            cursor: pointer;
        }

        #risk-score-min {
            background: linear-gradient(to right, #10b981 0%, #f59e0b 50%, #ef4444 100%);
        }

        #risk-score-max {
            background: linear-gradient(to right, #10b981 0%, #f59e0b 50%, #ef4444 100%);
        }

        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        #active-filters-display {
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Timeline Styles */
        .timeline-container {
            position: relative;
            padding-left: 30px;
        }

        .timeline-container::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            height: 100%;
            width: 2px;
            background: linear-gradient(to bottom, #6366f1, #8b5cf6);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding-left: 25px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #6366f1;
            border: 2px solid #fff;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .timeline-time {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 600;
        }

        .timeline-content {
            font-size: 0.9rem;
            color: #1f2937;
        }

        /* Message Evolution Styles */
        .message-stage {
            height: 100%;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .message-content {
            font-size: 0.875rem;
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
        }

        .bubble-item {
            background: #fff;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }

        /* Risk Score Bar */
        #risk-score-bar {
            transition: all 0.5s ease;
        }

        #risk-score-bar.bg-success {
            background-color: #10b981 !important;
        }

        #risk-score-bar.bg-warning {
            background-color: #f59e0b !important;
        }

        #risk-score-bar.bg-danger {
            background-color: #ef4444 !important;
        }

        /* CTA Timeline */
        .cta-timeline {
            max-height: 200px;
            overflow-y: auto;
        }

        .cta-event {
            padding: 12px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #6366f1;
        }

        .cta-event.sent {
            border-left-color: #3b82f6;
        }

        .cta-event.response {
            border-left-color: #10b981;
        }

        .cta-event.ignored {
            border-left-color: #6b7280;
        }

        /* Cost Breakdown */
        .cost-breakdown {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        /* Make table rows clickable */
        #data-table tbody tr {
            cursor: pointer;
        }

        #data-table tbody tr:hover {
            background-color: rgba(99, 102, 241, 0.05) !important;
        }

        /* Reviewer Notes Editable Styles */
        .reviewer-notes-cell {
            position: relative;
            max-width: 200px;
        }

        .reviewer-notes-display {
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
            min-height: 20px;
            word-break: break-word;
        }

        .reviewer-notes-display:hover {
            background-color: rgba(99, 102, 241, 0.1);
        }

        .reviewer-notes-display.empty {
            color: #9e9e9e;
            font-style: italic;
        }

        .reviewer-notes-input {
            width: 100%;
            min-height: 60px;
            padding: 8px;
            border: 2px solid var(--primary-color);
            border-radius: 4px;
            font-size: 0.875rem;
            resize: vertical;
            background: white;
        }

        .reviewer-notes-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .reviewer-notes-actions {
            margin-top: 8px;
            display: flex;
            gap: 8px;
        }

        .btn-save-notes {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .btn-cancel-notes {
            background: var(--text-secondary);
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="loading-spinner">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <!-- Auto-refresh Indicator -->
    <div class="auto-refresh-indicator">
        <i class="fas fa-sync-alt fa-spin"></i> Refreshing...
    </div>

    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon" id="theme-icon"></i>
    </button>

    <div class="main-container">
        <!-- Navigation Header -->
        <nav class="navbar navbar-expand-lg navbar-custom">
            <div class="container-fluid">
                <div class="d-flex align-items-center">
                    <h1 class="navbar-brand mb-0">
                        <i class="fas fa-chart-line text-primary me-2"></i>
                        Data Analytics
                    </h1>
                    <span class="badge bg-success ms-2">Live</span>
                </div>
                
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <small class="text-muted">Last updated: </small>
                        <span id="last-updated" class="badge bg-info">--</span>
                    </div>
                    <a href="index.html" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
                    </a>
                </div>
            </div>
        </nav>

        <div class="container-fluid p-4">
            <!-- Navigation Tabs -->
            <ul class="nav nav-pills nav-fill mb-4" id="main-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="overview-tab" data-bs-toggle="pill" data-bs-target="#overview" type="button" role="tab">
                        <i class="fas fa-tachometer-alt me-2"></i>Overview
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="data-tab" data-bs-toggle="pill" data-bs-target="#data" type="button" role="tab">
                        <i class="fas fa-table me-2"></i>Data Explorer
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="charts-tab" data-bs-toggle="pill" data-bs-target="#charts" type="button" role="tab">
                        <i class="fas fa-chart-bar me-2"></i>Analytics
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="backups-tab" data-bs-toggle="pill" data-bs-target="#backups" type="button" role="tab">
                        <i class="fas fa-database me-2"></i>Backups
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="management-tab" data-bs-toggle="pill" data-bs-target="#management" type="button" role="tab">
                        <i class="fas fa-cogs me-2"></i>Management
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="integrity-tab" data-bs-toggle="pill" data-bs-target="#integrity" type="button" role="tab">
                        <i class="fas fa-shield-alt me-2"></i>Data Integrity
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="main-tab-content">
                
                <!-- Overview Tab -->
                <div class="tab-pane fade show active" id="overview" role="tabpanel">
                    <!-- Key Metrics Row -->
                    <div class="row mb-4">
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="metric-card">
                                <div class="metric-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div class="metric-value" id="total-messages">--</div>
                                <div class="metric-label">Total Messages</div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="metric-card">
                                <div class="metric-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="metric-value" id="active-users">--</div>
                                <div class="metric-label">Active Users</div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="metric-card">
                                <div class="metric-icon" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                                    <i class="fas fa-dollar-sign"></i>
                                </div>
                                <div class="metric-value" id="daily-cost">--</div>
                                <div class="metric-label">Daily Cost (USD)</div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="metric-card">
                                <div class="metric-icon" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                                    <i class="fas fa-percentage"></i>
                                </div>
                                <div class="metric-value" id="cache-ratio">--</div>
                                <div class="metric-label">Cache Hit Ratio</div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats Row -->
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="chart-container">
                                <div class="chart-title">Messages Over Time (Last 30 Days)</div>
                                <canvas id="overview-chart"></canvas>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="chart-container">
                                <div class="chart-title">System Status</div>
                                <div class="d-flex flex-column gap-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>API Server</span>
                                        <span class="status-badge status-online">Online</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>Database</span>
                                        <span class="status-badge status-online">Connected</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>Redis Cache</span>
                                        <span class="status-badge status-online">Active</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>Queue Status</span>
                                        <span class="status-badge" id="queue-status">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Explorer Tab -->
                <div class="tab-pane fade" id="data" role="tabpanel">
                    <!-- Filters Panel -->
                    <div class="filters-panel">
                        <!-- Quick Filters Row -->
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label class="form-label fw-bold text-primary">
                                    <i class="fas fa-users me-1"></i>Customer Status
                                </label>
                                <select class="form-select" id="customer-status-filter" onchange="analytics.applyQuickFilters()">
                                    <option value="">All Statuses</option>
                                    <option value="PROSPECT">PROSPECT</option>
                                    <option value="LEAD_QUALIFIED">LEAD QUALIFIED</option>
                                    <option value="CUSTOMER">CUSTOMER</option>
                                    <option value="CHURNED">CHURNED</option>
                                    <option value="LEAD_EXHAUSTED">LEAD EXHAUSTED</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold text-danger">
                                    <i class="fas fa-exclamation-triangle me-1"></i>Risk Score
                                    <span class="badge bg-danger ms-2" id="risk-score-value">0.0 - 1.0</span>
                                </label>
                                <div class="d-flex align-items-center gap-2">
                                    <span class="text-success">0.0</span>
                                    <input type="range" class="form-range flex-grow-1" id="risk-score-min" 
                                           min="0" max="100" value="0" step="5"
                                           onchange="analytics.updateRiskScoreFilter()">
                                    <input type="range" class="form-range flex-grow-1" id="risk-score-max" 
                                           min="0" max="100" value="100" step="5"
                                           onchange="analytics.updateRiskScoreFilter()">
                                    <span class="text-danger">1.0</span>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label fw-bold text-info">
                                    <i class="fas fa-bullhorn me-1"></i>CTA Filters
                                </label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="cta-inserted-filter" 
                                           onchange="analytics.applyQuickFilters()">
                                    <label class="form-check-label" for="cta-inserted-filter">
                                        Solo con CTA insertado
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label fw-bold text-warning">
                                    <i class="fas fa-flag me-1"></i>Review Needed
                                </label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="needs-review-filter" 
                                           onchange="analytics.applyQuickFilters()">
                                    <label class="form-check-label" for="needs-review-filter">
                                        Necesita revisiÃ³n
                                        <small class="text-muted d-block">Risk > 0.5 or Not Approved</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-3">
                        
                        <!-- Advanced Filters Row -->
                        <div class="row">
                            <div class="col-md-3">
                                <label class="form-label">Search</label>
                                <input type="text" class="form-control" id="search-input" placeholder="Search messages...">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Date From</label>
                                <input type="date" class="form-control" id="date-from">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Date To</label>
                                <input type="date" class="form-control" id="date-to">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">User ID</label>
                                <input type="text" class="form-control" id="user-id-filter" placeholder="User ID">
                            </div>
                            <div class="col-md-3 d-flex align-items-end gap-2">
                                <button class="btn btn-primary-custom btn-custom" onclick="applyFilters()">
                                    <i class="fas fa-filter me-1"></i> Apply
                                </button>
                                <button class="btn btn-outline-secondary btn-custom" onclick="clearFilters()">
                                    <i class="fas fa-times me-1"></i> Clear All
                                </button>
                                <button class="btn btn-outline-success btn-custom" onclick="exportData()">
                                    <i class="fas fa-download me-1"></i> Export
                                </button>
                            </div>
                        </div>
                        
                        <!-- Active Filters Display -->
                        <div class="row mt-3" id="active-filters-display" style="display: none;">
                            <div class="col-12">
                                <div class="alert alert-info mb-0">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Active Filters:</strong>
                                    <span id="active-filters-text"></span>
                                    <button class="btn btn-sm btn-outline-info float-end" onclick="analytics.clearQuickFilters()">
                                        <i class="fas fa-times me-1"></i>Clear Quick Filters
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Table -->
                    <div class="table-container">
                        <table class="table table-striped table-hover" id="data-table">
                            <thead>
                                <tr>
                                    <!-- GRUPO 1: IdentificaciÃ³n y Estado -->
                                    <th>User ID</th>
                                    <th>Conv ID</th>
                                    <th>Customer Status</th>
                                    <th>Review Status</th>
                                    
                                    <!-- GRUPO 2: Contenido y Ediciones -->
                                    <th>User Message</th>
                                    <th>Final Bubbles</th>
                                    <th>Edit Tags</th>
                                    <th>Quality</th>
                                    
                                    <!-- GRUPO 3: Riesgos y CTA -->
                                    <th>Risk Score</th>
                                    <th>Constitution</th>
                                    <th>CTA Status</th>
                                    <th>Reviewer Notes</th>
                                    
                                    <!-- GRUPO 4: Performance -->
                                    <th>Review Time</th>
                                    <th>Cost</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Analytics Charts Tab -->
                <div class="tab-pane fade" id="charts" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-6 mb-4">
                            <div class="chart-container">
                                <div class="chart-title">CTA Distribution</div>
                                <canvas id="cta-chart"></canvas>
                            </div>
                        </div>
                        <div class="col-lg-6 mb-4">
                            <div class="chart-container">
                                <div class="chart-title">Quality Scores</div>
                                <canvas id="quality-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 mb-4">
                            <div class="chart-container">
                                <div class="chart-title">Activity Heatmap (Last 7 Days)</div>
                                <canvas id="heatmap-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6 mb-4">
                            <div class="chart-container">
                                <div class="chart-title">Customer Conversion Funnel</div>
                                <canvas id="funnel-chart"></canvas>
                            </div>
                        </div>
                        <div class="col-lg-6 mb-4">
                            <div class="chart-container">
                                <div class="chart-title">Daily Costs</div>
                                <canvas id="cost-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Backups Tab -->
                <div class="tab-pane fade" id="backups" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4>Database Backups</h4>
                        <button class="btn btn-primary-custom btn-custom" onclick="createBackup()">
                            <i class="fas fa-plus me-1"></i> Create Backup
                        </button>
                    </div>

                    <div id="backups-list">
                        <!-- Backups will be loaded dynamically -->
                    </div>
                </div>

                <!-- Management Tab -->
                <div class="tab-pane fade" id="management" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="chart-container">
                                <div class="chart-title">Data Cleanup</div>
                                <p class="text-muted">Remove test data or old records to keep your database clean.</p>
                                
                                <div class="mb-3">
                                    <label class="form-label">Cleanup Type</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="cleanup-type" id="test-data" value="test" checked>
                                        <label class="form-check-label" for="test-data">
                                            Test Data Only
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="cleanup-type" id="date-range" value="range">
                                        <label class="form-check-label" for="date-range">
                                            Date Range
                                        </label>
                                    </div>
                                </div>

                                <div id="date-range-inputs" class="mb-3" style="display: none;">
                                    <div class="row">
                                        <div class="col-6">
                                            <input type="date" class="form-control" id="cleanup-date-from">
                                        </div>
                                        <div class="col-6">
                                            <input type="date" class="form-control" id="cleanup-date-to">
                                        </div>
                                    </div>
                                </div>

                                <button class="btn btn-outline-warning btn-custom me-2" onclick="previewCleanup()">
                                    <i class="fas fa-eye me-1"></i> Preview
                                </button>
                                <button class="btn btn-warning btn-custom" onclick="executeCleanup()">
                                    <i class="fas fa-trash me-1"></i> Execute Cleanup
                                </button>

                                <div id="cleanup-preview" class="mt-3" style="display: none;">
                                    <!-- Preview results will appear here -->
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="chart-container">
                                <div class="chart-title">Export Options</div>
                                <p class="text-muted">Export your data in various formats for analysis.</p>
                                
                                <div class="mb-3">
                                    <label class="form-label">Export Format</label>
                                    <select class="form-select" id="export-format">
                                        <option value="csv">CSV (Comma Separated)</option>
                                        <option value="json">JSON (JavaScript Object)</option>
                                        <option value="xlsx">Excel (XLSX)</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Date Range (Optional)</label>
                                    <div class="row">
                                        <div class="col-6">
                                            <input type="date" class="form-control" id="export-date-from">
                                        </div>
                                        <div class="col-6">
                                            <input type="date" class="form-control" id="export-date-to">
                                        </div>
                                    </div>
                                </div>

                                <button class="btn btn-success btn-custom" onclick="exportFullData()">
                                    <i class="fas fa-download me-1"></i> Export Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Integrity Tab -->
                <div class="tab-pane fade" id="integrity" role="tabpanel">
                    <div class="row">
                        <!-- Summary Cards -->
                        <div class="col-12 mb-4">
                            <div class="row" id="integrity-summary">
                                <div class="col-md-3">
                                    <div class="metric-card text-center">
                                        <div class="metric-icon bg-primary text-white mx-auto mb-3 d-flex align-items-center justify-content-center">
                                            <i class="fas fa-database"></i>
                                        </div>
                                        <h5 class="fw-bold text-primary mb-1" id="schema-health">Checking...</h5>
                                        <p class="text-muted mb-0">Schema Health</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-card text-center">
                                        <div class="metric-icon bg-success text-white mx-auto mb-3 d-flex align-items-center justify-content-center">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <h5 class="fw-bold text-success mb-1" id="data-health">Checking...</h5>
                                        <p class="text-muted mb-0">Data Quality</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-card text-center">
                                        <div class="metric-icon bg-warning text-white mx-auto mb-3 d-flex align-items-center justify-content-center">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </div>
                                        <h5 class="fw-bold text-warning mb-1" id="alert-count">0</h5>
                                        <p class="text-muted mb-0">Active Alerts</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-card text-center">
                                        <div class="metric-icon bg-info text-white mx-auto mb-3 d-flex align-items-center justify-content-center">
                                            <i class="fas fa-sync-alt"></i>
                                        </div>
                                        <h5 class="fw-bold text-info mb-1" id="last-check">Never</h5>
                                        <p class="text-muted mb-0">Last Check</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Main Content -->
                        <div class="col-lg-8">
                            <!-- Alerts Section -->
                            <div class="chart-container mb-4">
                                <div class="chart-title d-flex justify-content-between align-items-center">
                                    <span><i class="fas fa-bell me-2"></i>Integrity Alerts</span>
                                    <button class="btn btn-outline-primary btn-sm" onclick="analytics.refreshIntegrity()">
                                        <i class="fas fa-sync me-1"></i>Refresh
                                    </button>
                                </div>
                                <div id="integrity-alerts">
                                    <div class="text-center py-4">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p class="mt-2 text-muted">Running integrity checks...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Data Quality Metrics -->
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-chart-pie me-2"></i>Data Quality Metrics
                                </div>
                                <div class="row" id="quality-metrics">
                                    <div class="col-md-6 mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>Customer Status Completion</span>
                                            <span class="badge bg-primary" id="customer-status-pct">0%</span>
                                        </div>
                                        <div class="progress mt-2">
                                            <div class="progress-bar" id="customer-status-bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>First Messages</span>
                                            <span class="badge bg-info" id="first-messages-pct">0%</span>
                                        </div>
                                        <div class="progress mt-2">
                                            <div class="progress-bar bg-info" id="first-messages-bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>Approved with Final Output</span>
                                            <span class="badge bg-success" id="approved-final-pct">0%</span>
                                        </div>
                                        <div class="progress mt-2">
                                            <div class="progress-bar bg-success" id="approved-final-bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>LLM Model Tracking</span>
                                            <span class="badge bg-warning" id="llm-models-pct">0%</span>
                                        </div>
                                        <div class="progress mt-2">
                                            <div class="progress-bar bg-warning" id="llm-models-bar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Side Panel -->
                        <div class="col-lg-4">
                            <!-- Schema Check -->
                            <div class="chart-container mb-4">
                                <div class="chart-title">
                                    <i class="fas fa-database me-2"></i>Schema Validation
                                </div>
                                <div id="schema-check">
                                    <div class="loading-placeholder">Loading schema check...</div>
                                </div>
                            </div>

                            <!-- Transformations Applied -->
                            <div class="chart-container">
                                <div class="chart-title">
                                    <i class="fas fa-exchange-alt me-2"></i>Data Transformations
                                </div>
                                <div id="transformations-list">
                                    <div class="loading-placeholder">Loading transformations...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Create Backup Modal -->
    <div class="modal fade" id="createBackupModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Backup</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Backup Name</label>
                        <input type="text" class="form-control" id="backup-name" placeholder="Optional custom name">
                        <div class="form-text">Leave empty for auto-generated name</div>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="include-data" checked>
                        <label class="form-check-label" for="include-data">
                            Include data (not just schema)
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="compress-backup" checked>
                        <label class="form-check-label" for="compress-backup">
                            Compress backup file
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="executeBackup()">Create Backup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Restore Backup Modal -->
    <div class="modal fade" id="restoreBackupModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Restore Backup</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Warning:</strong> This will replace all current data with the backup data. This action cannot be undone.
                    </div>
                    <p>Are you sure you want to restore from backup <strong id="restore-backup-name">--</strong>?</p>
                    <div class="mb-3">
                        <strong>Backup Details:</strong>
                        <ul>
                            <li>Created: <span id="restore-created-date">--</span></li>
                            <li>Size: <span id="restore-size">--</span></li>
                            <li>Type: <span id="restore-type">--</span></li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="executeRestore()">Restore Backup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Modal -->
    <div class="modal fade" id="progressModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <div id="progress-message">Processing...</div>
                    <div class="progress mt-3">
                        <div class="progress-bar progress-bar-custom" role="progressbar" style="width: 0%" id="progress-bar"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Full Details Modal - Redesigned -->
    <div class="modal fade" id="fullDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h5 class="modal-title">
                        <i class="fas fa-search-plus me-2"></i>
                        Message Details - <span id="detail-record-id">ID</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- SECCIÃ“N 1: Timeline -->
                    <div class="card mb-4">
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0"><i class="fas fa-clock me-2"></i>TIMELINE</h6>
                        </div>
                        <div class="card-body">
                            <div class="timeline-container" id="timeline-section">
                                <!-- Timeline items will be inserted here -->
                            </div>
                        </div>
                    </div>

                    <!-- SECCIÃ“N 2: Message Evolution -->
                    <div class="card mb-4">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0"><i class="fas fa-exchange-alt me-2"></i>MESSAGE EVOLUTION</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="message-stage">
                                        <h6 class="text-primary border-bottom pb-2">
                                            <i class="fas fa-user me-1"></i>User Message
                                        </h6>
                                        <div id="evolution-user" class="message-content"></div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="message-stage">
                                        <h6 class="text-info border-bottom pb-2">
                                            <i class="fas fa-robot me-1"></i>LLM1 Response
                                        </h6>
                                        <div id="evolution-llm1" class="message-content"></div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="message-stage">
                                        <h6 class="text-warning border-bottom pb-2">
                                            <i class="fas fa-magic me-1"></i>LLM2 Bubbles
                                        </h6>
                                        <div id="evolution-llm2" class="message-content"></div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="message-stage">
                                        <h6 class="text-success border-bottom pb-2">
                                            <i class="fas fa-check-circle me-1"></i>Final Version
                                        </h6>
                                        <div id="evolution-final" class="message-content"></div>
                                        <div id="evolution-edits" class="mt-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SECCIÃ“N 3: Analysis -->
                    <div class="card mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h6 class="mb-0"><i class="fas fa-chart-line me-2"></i>ANALYSIS</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Risk Assessment</h6>
                                    <div class="mb-3">
                                        <label class="form-label">Risk Score: <span id="risk-score-label">0.0</span></label>
                                        <div class="progress" style="height: 25px;">
                                            <div id="risk-score-bar" class="progress-bar" role="progressbar" style="width: 0%">
                                                <span id="risk-score-text">0.0</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="risk-flags" class="mb-3">
                                        <!-- Flags will be inserted here -->
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>Quality & Cost</h6>
                                    <div class="mb-3">
                                        <label class="form-label">Quality Score</label>
                                        <div id="quality-stars" class="fs-4">
                                            <!-- Stars will be inserted here -->
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Processing Cost</label>
                                        <div class="cost-breakdown">
                                            <div class="d-flex justify-content-between mb-2">
                                                <span>LLM1 (<span id="cost-llm1-model"></span>):</span>
                                                <strong id="cost-llm1-amount">$0.00</strong>
                                            </div>
                                            <div class="d-flex justify-content-between mb-2">
                                                <span>LLM2 (<span id="cost-llm2-model"></span>):</span>
                                                <strong id="cost-llm2-amount">$0.00</strong>
                                            </div>
                                            <hr>
                                            <div class="d-flex justify-content-between">
                                                <span><strong>Total Cost:</strong></span>
                                                <strong class="text-primary" id="cost-total">$0.00</strong>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SECCIÃ“N 4: Customer Journey -->
                    <div class="card mb-4">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="fas fa-route me-2"></i>CUSTOMER JOURNEY</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <h6>Current Status</h6>
                                    <div id="customer-status-display" class="mb-3">
                                        <!-- Status badge will be inserted here -->
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Lifetime Value</label>
                                        <h4 class="text-success" id="customer-ltv">$0.00</h4>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <h6>CTA History</h6>
                                    <div id="cta-history" class="cta-timeline">
                                        <!-- CTA history will be inserted here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-success" onclick="analytics.exportSingleRecord()">
                        <i class="fas fa-download me-1"></i> Export Record
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.4.1/js/responsive.bootstrap5.min.js"></script>
    
    <script src="data-analytics.js"></script>
</body>
</html>